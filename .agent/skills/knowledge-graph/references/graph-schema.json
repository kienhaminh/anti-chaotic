{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Knowledge Graph Index",
  "description": "Schema for .agent/graph-index.json",
  "type": "object",
  "required": ["version", "schema", "nodes"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Graph index version"
    },
    "generated_at": {
      "type": "string",
      "format": "date",
      "description": "Generation date (YYYY-MM-DD)"
    },
    "schema": {
      "type": "string",
      "enum": ["knowledge-graph"],
      "description": "Schema identifier"
    },
    "nodes": {
      "type": "object",
      "patternProperties": {
        "^[a-z0-9-]+$": {
          "$ref": "#/definitions/skillNode"
        }
      },
      "additionalProperties": false
    },
    "mocs": {
      "type": "object",
      "patternProperties": {
        "^[a-z0-9-]+$": {
          "$ref": "#/definitions/mocNode"
        }
      }
    },
    "conflict_matrix": {
      "type": "object",
      "additionalProperties": {
        "type": "array",
        "items": { "type": "string" }
      }
    },
    "learning_paths": {
      "type": "object",
      "additionalProperties": {
        "type": "array",
        "items": { "type": "string" }
      }
    }
  },
  "definitions": {
    "skillNode": {
      "type": "object",
      "required": ["name", "type", "path", "edges"],
      "properties": {
        "name": { "type": "string" },
        "type": {
          "type": "string",
          "enum": ["skill", "capability", "moc"]
        },
        "domain": { "type": "string" },
        "status": {
          "type": "string",
          "enum": ["stable", "draft", "deprecated"]
        },
        "version": { "type": "string" },
        "estimated_tokens": { "type": "number" },
        "path": { "type": "string" },
        "edges": {
          "type": "object",
          "properties": {
            "extends": { "type": "array", "items": { "type": "string" } },
            "requires": { "type": "array", "items": { "type": "string" } },
            "suggests": { "type": "array", "items": { "type": "string" } },
            "conflicts": { "type": "array", "items": { "type": "string" } },
            "enhances": { "type": "array", "items": { "type": "string" } },
            "moc": { "type": "array", "items": { "type": "string" } }
          }
        }
      }
    },
    "mocNode": {
      "type": "object",
      "required": ["path", "skills"],
      "properties": {
        "path": { "type": "string" },
        "domain": { "type": "string" },
        "skills": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    }
  }
}
